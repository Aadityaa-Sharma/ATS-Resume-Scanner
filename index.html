<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATS Resume Scanner</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --white-bg: #f8f9fa;
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --accent-blue: #0d6efd;
            --light-blue: #e0f2fe;
            --success-green: #198754;
            --success-green-light: #f0fdf4;
            --warning-amber: #ffc107;
            --warning-amber-light: #fffbeb;
            --danger-red: #dc3545;
            --info-cyan: #0dcaf0;
            --info-cyan-light: #ecfeff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--white-bg);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 40px 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            max-width: 1000px;
            width: 100%;
            margin: 0 auto;
        }

        .header {
            text-align: left;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            color: var(--text-secondary);
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr; /* Default to single column */
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (min-width: 900px) { /* Two columns on larger screens */
            .main-grid {
                grid-template-columns: 1fr 2fr;
            }
        }
        
        .upload-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 40px 30px;
            text-align: center;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s ease;
        }
        .upload-area:hover { border-color: var(--accent-blue); background-color: #fafdff; }
        .upload-icon svg { width: 48px; height: 48px; margin-bottom: 20px; color: var(--text-secondary); }
        .upload-text { font-size: 1.1rem; font-weight: 600; margin-bottom: 8px; }
        .upload-subtext { color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 15px; }
        .file-input { display: none; }
        .browse-btn {
            background-color: var(--accent-blue);
            color: white;
            border: none;
            padding: 10px 25px;
            font-size: 0.95rem;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
        }

        .analyze-btn {
            background-color: var(--accent-blue);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
        }
        .analyze-btn:hover:not(:disabled) { background-color: #0b5ed7; }
        .analyze-btn:disabled { background-color: #adb5bd; cursor: not-allowed; }
        
        .ready-to-analyze-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
        }
        .ready-to-analyze-card .icon svg { width: 60px; height: 60px; color: var(--border-color); margin-bottom: 20px; }
        .ready-to-analyze-card h3 { font-size: 1.3rem; font-weight: 600; margin-bottom: 10px; }
        .ready-to-analyze-card p { color: var(--text-secondary); font-size: 0.95rem; }

        .loading, .results { display: none; }
        
        .loading-header { display: flex; align-items: center; font-size: 1.3rem; font-weight: 600; margin-bottom: 20px; }
        .loading-spinner {
            width: 24px; height: 24px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .progress-bar-container { width: 100%; height: 8px; background-color: var(--white-bg); border-radius: 4px; margin-bottom: 25px; overflow: hidden; border: 1px solid var(--border-color);}
        .progress-bar-fill { width: 0%; height: 100%; background-color: var(--accent-blue); border-radius: 4px; transition: width 0.3s ease-in-out; }

        .progress-stages { display: flex; justify-content: space-between; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;}
        .stage-item { display: flex; align-items: center; color: var(--text-secondary); font-weight: 500; transition: color 0.3s ease; }
        .stage-item.active { color: var(--accent-blue); }
        .stage-item svg { width: 20px; height: 20px; margin-right: 8px; }
        .loading-footer { text-align: center; color: var(--text-secondary); font-size: 0.9rem; }

        .score-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .score-card { padding: 25px; text-align: center; }
        .score-card .icon-wrapper { width: 50px; height: 50px; margin: 0 auto 15px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background-color: var(--light-blue); }
        .score-card .icon svg { width: 24px; height: 24px; }
        .value { font-size: 2.2rem; font-weight: 700; margin-bottom: 5px; }
        .label { color: var(--text-secondary); font-size: 0.9rem; font-weight: 500; }
        .ats-score .icon svg, .ats-score .value { color: #0d6efd; }
        .job-match .icon svg, .job-match .value { color: var(--success-green); }
        .keywords .icon svg, .keywords .value { color: var(--warning-amber); }
        .improvement .icon svg, .improvement .value { color: #17a2b8; }
        .analysis-sections { display: grid; gap: 30px; }
        .analysis-header { padding: 20px 30px; font-size: 1.3rem; font-weight: 600; display: flex; align-items: center; gap: 15px; border-bottom: 1px solid var(--border-color); }
        .analysis-header svg { width: 24px; height: 24px; color: var(--accent-blue); }
        .analysis-content { padding: 30px; }
        .profile-match { display: grid; grid-template-columns: 1fr; gap: 20px; }
        @media (min-width: 768px) { .profile-match { grid-template-columns: repeat(2, 1fr); } }
        .profile-card { background-color: var(--white-bg); border: 1px solid var(--border-color); border-radius: 10px; padding: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .profile-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 10px; }
        .compatibility-bar { background-color: #e9ecef; border-radius: 5px; height: 8px; margin: 15px 0; overflow: hidden; }
        .compatibility-fill { height: 100%; background-color: var(--accent-blue); border-radius: 5px; }
        .keyword-tag { background-color: #e9ecef; color: var(--text-secondary); padding: 4px 10px; border-radius: 6px; font-size: 0.8rem; font-weight: 500; display: inline-block; margin: 2px; }
        .missing-keyword { background-color: var(--danger-red); color: white; }
        .section-title { font-size: 1.2rem; font-weight: 600; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color); margin-top: 25px; }
        .section-title:first-child { margin-top: 0; }
        .strengths-box, .issues-box, .recommendations { padding: 15px; border-radius: 8px; margin: 15px 0; line-height: 1.6; }
        
        .strengths-box { background-color: var(--success-green-light); border-left: 4px solid var(--success-green); color: #0a3622; }
        .issues-box { background-color: var(--warning-amber-light); border-left: 4px solid var(--warning-amber); color: #664d03; }
        .recommendations { background-color: var(--info-cyan-light); border-left: 4px solid var(--info-cyan); color: #055160; }

        h4 { font-size: 1.05rem; font-weight: 600; margin-bottom: 8px; }
        .result-list { list-style: none; padding-left: 0; }
        .result-list li { margin-bottom: 8px; font-size: 0.95rem; }
        
        .priority-title { font-size: 1.15rem; font-weight: 600; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .priority-critical { color: var(--danger-red); }
        .priority-high { color: var(--warning-amber); }
        .priority-medium { color: var(--success-green); }
        .action-item { background-color: var(--white-bg); border: 1px solid var(--border-color); padding: 12px 18px; border-radius: 8px; margin-bottom: 8px; font-size: 0.95rem; }
        .download-section { text-align: center; margin-top: 40px; }
        .download-btn { background-color: var(--accent-blue); color: white; font-weight: 600; border: none; padding: 12px 30px; font-size: 1.05rem; border-radius: 8px; cursor: pointer; transition: background-color 0.2s ease; text-decoration: none; display: inline-block; }
        .download-btn:hover { background-color: #0b5ed7; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ATS Resume Scanner</h1>
            <p>Upload your resume to get detailed ATS compatibility analysis and improvement recommendations.</p>
        </div>

        <div class="main-grid" id="mainGrid">
            <div class="upload-section">
                <div class="card upload-area" id="uploadArea">
                    <div class="upload-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg></div>
                    <div class="upload-text">Drop your PDF or TXT resume here</div>
                    <div class="upload-subtext">or click to browse files</div>
                    <input type="file" id="fileInput" class="file-input" accept=".pdf,.txt">
                    <button class="browse-btn" id="browseBtn">Browse Files</button>
                </div>
                <button class="analyze-btn" id="analyzeResumeBtn" disabled>Analyze Resume</button>
            </div>

            <div class="card" id="analysisContainer">
                <div id="readyToAnalyzeCard" class="ready-to-analyze-card">
                    <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/><path d="M3 20h18"/></svg></div>
                    <h3>Ready to Analyze</h3>
                    <p>Upload your resume and click "Analyze Resume" to get started</p>
                </div>
                <div class="loading" id="loadingSection">
                    <div class="loading-header"><div class="loading-spinner"></div><span>Analyzing Resume</span></div>
                    <div class="progress-bar-container"><div class="progress-bar-fill" id="progressBar"></div></div>
                    <div class="progress-stages">
                        <div class="stage-item" id="stage1"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg><span>Parsing File</span></div>
                        <div class="stage-item" id="stage2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 18a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2"/><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M12 8v4"/><path d="M12 16h.01"/></svg><span>Analyzing Content</span></div>
                        <div class="stage-item" id="stage3"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M18.7 8a6 6 0 0 0-8.3-8.3"/><path d="M13.3 13.3a6 6 0 0 0 8.3 8.3"/></svg><span>Calculating Score</span></div>
                    </div>
                    <div class="loading-footer"><p>This usually takes 10-15 seconds...</p></div>
                </div>
            </div>
        </div>
        
        <div class="results" id="resultsSection">
        </div>
    </div>

    <script>
        // --- DOM Element References ---
        const mainGrid = document.getElementById('mainGrid');
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const browseBtn = document.getElementById('browseBtn');
        const analyzeResumeBtn = document.getElementById('analyzeResumeBtn');
        
        const analysisContainer = document.getElementById('analysisContainer');
        const readyToAnalyzeCard = document.getElementById('readyToAnalyzeCard');
        const loadingSection = document.getElementById('loadingSection');
        const resultsSection = document.getElementById('resultsSection');
        
        const progressBar = document.getElementById('progressBar');
        const stage1 = document.getElementById('stage1');
        const stage2 = document.getElementById('stage2');
        const stage3 = document.getElementById('stage3');
        
        let selectedFile = null;
        let progressInterval = null;

        // --- Event Listeners ---
        uploadArea.addEventListener('click', () => fileInput.click());
        browseBtn.addEventListener('click', (event) => {
            event.stopPropagation();
            fileInput.click();
        });
        
        uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('dragover'); });
        uploadArea.addEventListener('dragleave', (e) => { e.preventDefault(); uploadArea.classList.remove('dragover'); });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            handleFile(e.dataTransfer.files[0]);
        });
        
        fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));

        analyzeResumeBtn.addEventListener('click', () => {
            if (selectedFile) {
                updateUIState('loading');
                simulateProgress();
                analyzeResume(selectedFile);
            }
        });

        // --- Core Functions ---
        function handleFile(file) {
            const allowedTypes = ['application/pdf', 'text/plain'];
            if (!file || !allowedTypes.includes(file.type)) {
                alert('Please select a valid PDF or TXT file.');
                return;
            }
            selectedFile = file;
            const uploadText = uploadArea.querySelector('.upload-text');
            uploadText.textContent = `File: ${file.name}`;
            uploadText.style.fontSize = '1rem';
            updateUIState('file-selected');
        }

        function analyzeResume(file) {
            const formData = new FormData();
            formData.append('resume', file);
            
            setTimeout(() => {
                fetch('/features/manual-scanner/analyze', { method: 'POST', body: formData })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        clearInterval(progressInterval);
                        progressBar.style.width = '100%';
                        if (data.success) {
                            setTimeout(() => {
                                displayResults(data.analysis);
                                updateUIState('results');
                            }, 500);
                        } else {
                            alert('Error analyzing resume: ' + data.error);
                            resetToInitialState();
                        }
                    })
                    .catch(error => {
                        clearInterval(progressInterval);
                        console.error('Error:', error);
                        alert('An error occurred while analyzing the resume. Please check the console for details.');
                        resetToInitialState();
                    });
            }, 1000);
        }
        
        function simulateProgress() {
            let progress = 0;
            [stage1, stage2, stage3].forEach(s => s.classList.remove('active'));
            progressBar.style.width = '0%';

            progressInterval = setInterval(() => {
                progress += 1;
                progressBar.style.width = `${progress}%`;

                if (progress >= 10) stage1.classList.add('active');
                if (progress >= 45) stage2.classList.add('active');
                if (progress >= 85) stage3.classList.add('active');
                if (progress >= 100) clearInterval(progressInterval);
            }, 30);
        }

        // --- UI Update Functions ---
        function updateUIState(state) {
            readyToAnalyzeCard.style.display = 'none';
            loadingSection.style.display = 'none';
            resultsSection.style.display = 'none';
            mainGrid.style.display = 'grid';
            
            if (state === 'initial') {
                readyToAnalyzeCard.style.display = 'flex';
                analyzeResumeBtn.disabled = true;
            } else if (state === 'file-selected') {
                readyToAnalyzeCard.style.display = 'flex';
                analyzeResumeBtn.disabled = false;
            } else if (state === 'loading') {
                loadingSection.style.display = 'block';
                analyzeResumeBtn.disabled = true;
                analyzeResumeBtn.textContent = 'Analyzing...';
            } else if (state === 'results') {
                mainGrid.style.display = 'none';
                resultsSection.style.display = 'block';
            }
        }
        
        function resetToInitialState() {
            selectedFile = null;
            fileInput.value = '';
            clearInterval(progressInterval);
            const uploadText = uploadArea.querySelector('.upload-text');
            uploadText.textContent = 'Drop your PDF or TXT resume here';
            uploadText.style.fontSize = '1.1rem';
            analyzeResumeBtn.textContent = 'Analyze Resume';
            updateUIState('initial');
        }
        
        // --- Display Results Functions ---
        function displayResults(analysis) {
             resultsSection.innerHTML = `
                <div class="score-cards">
                    <div class="card score-card ats-score"><div class="icon-wrapper"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/><path d="M3 20h18"/></svg></div></div><div class="value">${analysis.ats_score}/100</div><div class="label">ATS Score</div></div>
                    <div class="card score-card job-match"><div class="icon-wrapper"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg></div></div><div class="value">${analysis.best_job_match.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</div><div class="label">Best Job Match</div></div>
                    <div class="card score-card keywords"><div class="icon-wrapper"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 18v3c0 .6.4 1 1 1h4v-3h3v-3h2l1.4-1.4a6.5 6.5 0 1 0-4-4Z"/><circle cx="16.5" cy="7.5" r=".5"/></svg></div></div><div class="value">${analysis.tech_keywords_found}</div><div class="label">Technical Keywords</div></div>
                    <div class="card score-card improvement"><div class="icon-wrapper"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg></div></div><div class="value">${analysis.improvement_potential}/100</div><div class="label">Improvement Potential</div></div>
                </div>
                <div class="analysis-sections">
                    <div class="card" id="job-profile-card-results"></div>
                    <div class="card" id="section-analysis-card-results"></div>
                    <div class="card" id="action-plan-card-results"></div>
                </div>
                <div class="card download-section">
                    <h3>Download Detailed Report</h3>
                    <p style="color: var(--text-secondary); margin: 10px 0 20px;">Get a comprehensive text file with all analysis details.</p>
                    <a href="/features/manual-scanner/download/${analysis.report_id}" class="download-btn">Download Full Report</a>
                </div>
            `;
            
            displayProfileMatches(analysis.job_matches);
            displaySectionAnalysis(analysis.sections);
            displayActionPlan(analysis.recommendations);
        }
        
        function displayProfileMatches(jobMatches) {
            const container = document.getElementById('job-profile-card-results');
            const sortedMatches = Object.entries(jobMatches).sort((a, b) => b[1].score - a[1].score);
            container.innerHTML = `<div class="analysis-header"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="3" x2="21" y1="9" y2="9"/><line x1="3" x2="21" y1="15" y2="15"/><line x1="9" x2="9" y1="3" y2="21"/><line x1="15" x2="15" y1="3" y2="21"/></svg><span>Job Profile Compatibility</span></div><div class="analysis-content"><div class="profile-match">${sortedMatches.slice(0, 6).map(([profileId, match]) => `<div class="profile-card"><div class="profile-title">${match.title}</div><div class="compatibility-bar"><div class="compatibility-fill" style="width: ${Math.round(match.score)}%"></div></div><div style="text-align: center; font-weight: 600; color: var(--accent-blue); margin-bottom: 15px;">${Math.round(match.score)}% Match</div><div style="font-size: 0.9rem; color: var(--text-secondary);">✅ Required: ${match.required_found}/${match.required_total} | ⭐ Preferred: ${match.preferred_found}/${match.preferred_total}</div>${match.missing_required.length > 0 ? `<div style="margin-top: 15px;"><div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 8px;">Missing Critical:</div><div class="keywords-list">${match.missing_required.slice(0, 3).map(kw => `<span class="keyword-tag missing-keyword">${kw}</span>`).join('')}</div></div>` : ''}</div>`).join('')}</div></div>`;
        }
        
        function displaySectionAnalysis(sections) {
            const container = document.getElementById('section-analysis-card-results');
            container.innerHTML = `<div class="analysis-header"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></svg><span>Section-by-Section Analysis</span></div><div class="analysis-content">${Object.entries(sections).map(([sectionName, analysis]) => `<div><div class="section-title">${sectionName.replace(/_/g, ' ').toUpperCase()}</div>${analysis.strengths.length > 0 ? `<div class="strengths-box"><h4>Strengths</h4><ul class="result-list">${analysis.strengths.map(s => `<li>${s}</li>`).join('')}</ul></div>` : ''}${analysis.issues.length > 0 ? `<div class="issues-box"><h4>Issues</h4><ul class="result-list">${analysis.issues.map(i => `<li>${i}</li>`).join('')}</ul></div>` : ''}${analysis.recommendations.length > 0 ? `<div class="recommendations"><h4>Recommendations</h4><ul class="result-list">${analysis.recommendations.map(r => `<li>${r}</li>`).join('')}</ul></div>` : ''}</div>`).join('<hr style="border: none; border-top: 1px solid #f0f4f7; margin: 30px 0;">')}</div>`;
        }
        
        function displayActionPlan(recommendations) {
            const container = document.getElementById('action-plan-card-results');
            const createSection = (title, className, items) => items.length > 0 ? `<div class="priority-section"><div class="priority-title ${className}">${title}</div>${items.map(action => `<div class="action-item">${action}</div>`).join('')}</div>` : '';
            container.innerHTML = `<div class="analysis-header"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 16 2 2 4-4"/><path d="m3 12 2 2 4-4"/><path d="m3 8 2 2 4-4"/><path d="M11 6h8"/><path d="M11 12h8"/><path d="M11 18h8"/></svg><span>Prioritized Action Plan</span></div><div class="analysis-content">${createSection('Critical Priority', 'priority-critical', recommendations.critical)}${createSection('High Priority', 'priority-high', recommendations.high)}${createSection('Medium Priority', 'priority-medium', recommendations.medium)}</div>`;
        }

        // --- Initialize UI state on load ---
        updateUIState('initial');
    </script>
</body>
</html>
i have also updated my file input to accept text files but its not working, help me with that too in a single response
